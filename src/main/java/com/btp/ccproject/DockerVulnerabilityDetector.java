package com.btp.ccproject;

import com.btp.ccproject.Model.DetectionResult;
import com.btp.ccproject.Model.SoftwarePackage;
import com.btp.ccproject.Model.VulnerabilityEntry;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

@Service
public class DockerVulnerabilityDetector {

    public List<DetectionResult> detectVulnerabilities(List<SoftwarePackage> installedPackages, List<VulnerabilityEntry> vulnerabilityDB) {
        List<DetectionResult> results = new ArrayList<>();
        int index = 1;

        for (SoftwarePackage pkg : installedPackages) {
            for (VulnerabilityEntry vuln : vulnerabilityDB) {
                if (pkg.getLayerID().equals(vuln.getLayerID()) &&
                        pkg.getName().equalsIgnoreCase(vuln.getName()) &&
                        pkg.getVersion().equalsIgnoreCase(vuln.getVersion())) {

                    results.add(new DetectionResult(pkg.getIndex(), vuln.getIndex()));
                    index++;
                }
            }
        }

        return results;
    }
}

